# Ice CAD 要件定義書

**最終更新**: 2025年12月15日（打ち合わせ後）

## 1. プロジェクト概要

### 1.1 目的
アイスキャンディーの金型（型）を設計するためのデスクトップアプリケーション。地名などの日本語テキストを入力することで、製造に必要な2D技術図面と3Dモデルを自動生成する。

### 1.2 2つの用途（重要）

#### 用途1: 特許事務所への3Dファイル（最優先）
- **目的**: 特許申請用
- **要件**: くるくる回せる形式（HTML/PDFなど）
- **厳密性**: そこまで厳密でなくていい（デザインが申請されていることが確認できればOK）
- **優先度**: **最優先（急ぎ）**

#### 用途2: 金型業者への2D図面
- **目的**: 金型製造用
- **要件**: できるだけ精密に
- **厳密性**: 細かい調整は金型業者に任せる
- **優先度**: 次（3Dモデルができた後に取り組む）

### 1.3 対象ユーザー
- **特許事務所**: 特許申請用の3Dファイルを確認
- **金型製造業者**: 2D図面から金型を製造
- **アイスキャンディー製造業者**: デザイン確認・量産準備
- **デザイナー**: 図面の知識がなくても使用可能

### 1.4 主要機能
1. **日本語テキスト入力** - 地名などを入力（例：「鎌倉」「渋谷」）
2. **3Dモデルの生成・出力** - 特許申請用のくるくる回せるファイル（HTML/PDF）
3. **2D技術図面の自動生成** - 金型製造に必要な6つの視点を含む図面
4. **パラメータ調整** - テキストの位置、サイズ、回転などを調整
5. **図面の出力** - PNG形式でダウンロード

### 1.5 開発優先順位（重要）
1. **最優先**: 3Dモデル（特許申請用、急ぎ）
2. **次**: 2D図面（金型業者用、精密に）

---

## 2. 製品仕様（金型の物理的寸法）

### 2.1 外形寸法（固定値 - 変更不可）

#### 全体サイズ
- **外側サイズ（フランジ含む）**: 76.91mm × 113.91mm
- **内側サイズ（開口部）**: 70.00mm × 107.00mm
- **総高さ（深さ）**: 24.60mm
- **容器内深さ**: 24.50mm（フランジ面から底面まで）

#### キャビティ（文字を彫り込む領域）
- **幅**: 57.90mm
- **長さ**: 97.30mm
- **文字彫り込み深さ**: 3.00mm（底面から3mm深く彫る）

#### 文字サイズ（クライアント提供情報）
- **最大サイズ**: 縦105mm × 横62mm
  - キャビティサイズ（57.90mm × 97.30mm）より大きいため、実際にはキャビティ内に収まるサイズに調整される

#### コーナー半径（R）
- **外側コーナー**: R9.46mm
- **内側コーナー**: R6.00mm

#### フランジ（縁の部分）
- **幅**: 3.455mm（外側と内側の差の半分）

### 2.2 勾配（テーパー角度）
金型は抜きやすくするため、側面に勾配がついています：
- **外側勾配**: 8°（側面の外側）
- **内側勾配（スティック部）**: 4°（スティック挿入部分）

### 2.3 スティック挿入部
アイスキャンディーに棒を挿入するための切り欠き：
- **幅**: 14.00mm（中心から左右7.00mmずつ）
- **高さ**: 12.00mm
- **位置**: 底面中央

### 2.4 材料厚
- **材料厚**: 0.1mm（図面上の表示用）

---

## 3. 機能要件

### 3.1 テキスト入力機能

#### 入力可能な文字
- **文字種**: 漢字、ひらがな、カタカナ
- **文字数**: 1〜4文字
- **レイアウト**: 縦書き（上から下へ配置）
- **例**: 「鎌倉」「渋谷」「原宿」「東京」

#### 制約
- 最大4文字まで
- 日本語のみ（英数字は未対応）

### 3.2 可変パラメータ（ユーザーが調整可能）

#### 配置位置
- **X方向**: -20.0mm ～ +20.0mm（0.5mm刻み）
  - 正の値：右へ移動
  - 負の値：左へ移動
- **Y方向**: -20.0mm ～ +20.0mm（0.5mm刻み）
  - 正の値：上へ移動
  - 負の値：下へ移動

#### スケール（サイズ）
- **範囲**: 50% ～ 150%（5%刻み）
- **デフォルト**: 100%
- 文字全体のサイズを拡大・縮小

#### 回転角度
- **範囲**: -180° ～ +180°（5°刻み）
- **デフォルト**: 0°
- 文字全体を回転

#### 文字埋め処理（重要 - クライアント提供情報に基づく）

**アプローチ**: 土台（板）を作って、その上に文字を浮かせる

**実装方法**:
1. **土台（板）を作る**: 四角い長方形の板を下に配置
2. **文字を上に乗せる**: その上に文字を浮かせる
3. **周りを削る**: 周りの余計なところを削る
4. **アウトラインを漢字に合わせる**: 漢字の外側のフォルムに合わせる（クライアント確認済み）

**ルール**（クライアント提供情報）:
- **アイスクリームの外枠**: 基本的に漢字に沿っている
- **アウトライン**: 漢字に沿わせる（クライアント確認済み）
- **文字と文字の間**: 段が下がって埋まっている（例：「カ」と「ク」を繋いでいる部分）
- **文字の内側**: **埋まっている**（クライアント提供情報により修正）
- **裏面から見た時**: 塗りつぶした板みたい（「鎌倉」という字になっていない）
- **文字と文字の間の埋め方**: 多少太かろうが細かろうが関係ない

**固定パラメータ**（クライアント提供情報）:
- **文字の最大サイズ**: 縦105mm × 横62mm
- **土台から文字の厚み**: 3mm（文字の高さ）
- **土台の厚み**: 19mm
- **アイスの総厚み**: 22mm（土台19mm + 文字3mm）
- **文字のテーパー角度**: 8°（できれば実装、推奨）
- **棒の位置**: 中央（固定、変わらない）

### 3.3 2D図面生成機能（金型業者用）

#### 図面の全体構成

**レイアウト**
図面はA3横サイズ風のキャンバス（1400×900ピクセル）に、以下の6つの視点を配置します：

```
┌─────────────────────────────────────────────────────────┐
│  [正面断面図]                                           │
│                                                         │
├──────────┬──────────┬──────────┬──────────┬──────────┤
│          │          │          │          │          │
│ [側面    │ [上面図] │ [深さ    │ [意匠    │          │
│ 断面図]  │ (メイン) │ 断面図]  │ 面図]    │          │
│          │          │          │          │          │
├──────────┴──────────┴──────────┴──────────┴──────────┤
│  [底面図]                                             │
└─────────────────────────────────────────────────────────┘
```

**図面枠**
- **外枠**: 黒い太線（2px）
- **グリッド**: 8列×6行の参照グリッド
- **行ラベル**: F, E, D, C, B, A（下から上）
- **列ラベル**: 8, 7, 6, 5, 4, 3, 2, 1（右から左）

**タイトルブロック**
- **位置**: 右下
- **サイズ**: 320×130ピクセル
- **内容**: 
  - 製品名（入力した文字 + "投影図"）
  - 図面サイズ（A3）
  - 設計者欄、作成者、改訂履歴などの項目

#### 生成される図面の種類（6つの視点の詳細）

##### 1. 側面断面図（左端）

**位置**: 図面の左端、上面図と同じ高さ

**表示内容**: 金型を横から見た断面（金型を縦に切った時の断面）

- **外形**: 横幅24.60mm（深さ方向）、高さ113.91mm（外形高さ）、長方形
- **内側線**: 内形高さ107.00mm、上下にフランジ（縁）が3.455mmずつ
- **ハッチング**: 断面部分に斜線を描画
- **中心線**: 横方向の一点鎖線
- **注釈**: 勾配8°（外側）、勾配4°（スティック部）、R9.46（外側コーナー）、R6.00（内側コーナー）

##### 2. 上面図（中央、メイン）

**位置**: 図面の中央、メインの図面

**表示内容**: 金型を上から見た図（金型の上面を真上から見下ろした時の形状）

- **最外形（フランジ）**: 76.91mm × 113.91mm、コーナー半径R9.46mm、角丸長方形
- **開口部（内側）**: 70.00mm × 107.00mm、コーナー半径R6.00mm、中心に配置
- **キャビティ（文字エリア）**: 57.90mm × 97.30mm、コーナー半径R3.60mm、破線で表示
- **スティック切り欠き**: 下部中央、幅14.00mm、深さ約6.67mm、コの字型
- **文字表示**: 
  - 鏡文字（左右反転）で表示
  - ハッチング（斜線）で塗りつぶし
  - 輪郭線（太線）で輪郭を描画
  - 理由：金型の底面から見た時の文字の形を表現
- **中心線**: 縦方向・横方向の一点鎖線
- **寸法線（多数表示）**:
  - 上部（横方向）: 外形幅76.91mm、内形幅70.00mm、内形半幅35.00mm × 2、キャビティ幅57.90mm
  - 右側（縦方向）: 外形高さ113.91mm、内形高さ107.00mm、内形半高53.50mm × 2
  - 左側（縦方向）: キャビティ長さ97.30mm
  - 下部（横方向）: スティック半幅7.00mm × 2、スティック全幅14.00mm
- **注釈**: 勾配4°（スティック部）、R9.46（外側コーナー）、R6.00（内側コーナー）

##### 3. 正面断面図（上面図の上）

**位置**: 上面図の真上、同じ幅

**表示内容**: 金型を正面から見た断面（金型を横に切った時の断面）

- **形状**: 台形断面
  - 上面（広い方）: 76.91mm
  - 底面（狭い方）: 70.00mm
  - 高さ: 24.60mm（深さ方向）
- **勾配**: 側面が斜めになっている（テーパー）、上面が広く底面が狭い
- **スティック切り欠き**: 底面中央、幅14.00mm、深さ約3.20mm、コの字型
- **ハッチング**: 断面部分に斜線を描画
- **中心線**: 縦方向の一点鎖線

##### 4. 深さ方向断面図（上面図の右）

**位置**: 上面図の右側、同じ高さ

**表示内容**: 金型の深さ方向の断面（深さに関する詳細な寸法を表示）

- **形状**: 横幅24.60mm（深さ方向）、高さ113.91mm（外形高さ）、長方形
- **内側線**: 内形高さ107.00mm、上下にフランジ（縁）が3.455mmずつ
- **ハッチング**: 断面部分に斜線を描画
- **中心線**: 横方向の一点鎖線
- **寸法線（深さに関する詳細）**:
  - 上部（横方向、深さ寸法）: 容器内深さ24.50mm、段差までの深さ21.50mm、文字部分深さ3.00mm
  - 左側（縦方向）: 内形高さ107.00mm
  - 右側（縦方向）: 外形高さ113.91mm、内形半高53.50mm × 2
  - 下部（注釈）: 1.72mm（微小オフセット）、3.40mm（フランジ幅）、12.00mm（スティック部の高さ）、24.60mm（総高さ）

##### 5. 意匠面図（右端）

**位置**: 図面の右端、上面図と同じ高さ

**表示内容**: 文字が彫り込まれる面を正面から見た図（実際に彫り込まれる文字の見た目を表示）

- **外形**: 76.91mm × 113.91mm、コーナー半径R6.00mm、角丸長方形
- **中心線**: 縦方向・横方向の一点鎖線
- **文字表示**: 
  - 通常の文字（鏡文字ではない）
  - 輪郭線のみ（ハッチングなし）
  - 位置：キャビティエリア内（57.90mm × 97.30mm）
  - 理由：実際に彫り込まれる文字の見た目を確認するため
- **寸法線**: 横方向76.91mm、縦方向113.91mm

##### 6. 底面図（上面図の下）

**位置**: 上面図の真下、同じ幅

**表示内容**: 金型の底面を上から見た図（金型をひっくり返して上から見た時の形状）

- **形状**: 台形断面（左右で高さが異なる）
  - 上面（狭い方）: 70.00mm
  - 底面（広い方）: 76.91mm
  - 左側高さ: 12.00mm
  - 右側高さ: 24.60mm
- **スティック切り欠き**: 底面中央、幅14.00mm、深さ約3.20mm、コの字型、内部に縦線2本（装飾）
- **ハッチング**: 断面部分に斜線を描画
- **寸法線**:
  - 上部（横方向）: 上面幅70.00mm
  - 下部（横方向）: 底面幅76.91mm
  - 左側（縦方向）: 左側高さ12.00mm
  - 右側（縦方向）: 右側高さ24.60mm

#### 図面の共通要素

**寸法線の形式**
- **水平寸法線**: 矢印付き、寸法値は中央に表示
- **垂直寸法線**: 矢印付き、寸法値は回転して表示
- **寸法値**: mm単位、9px Arialフォント

**中心線の形式**
- **線種**: 一点鎖線
- **パターン**: 長い線（15px）・短い線（3px）・短い線（3px）・短い線（3px）の繰り返し
- **色**: 黒
- **線幅**: 0.4px

**ハッチングの形式**
- **線種**: 斜線
- **角度**: 約45度
- **間隔**: 4px
- **線幅**: 0.3px
- **色**: 黒

**線の種類と太さ**

| 線の種類 | 線幅 | 用途 |
|---------|------|------|
| 外形線 | 1.2px | 金型の外形を描く |
| 内側線 | 0.8px | 内側の線を描く |
| 中心線 | 0.4px | 中心を示す（一点鎖線） |
| 寸法線 | 0.4px | 寸法を示す |
| ハッチング | 0.3px | 断面を表現 |
| 文字輪郭 | 1.2px | 文字の輪郭 |

**色**
- **背景**: 白（#ffffff）
- **線・文字**: 黒（#000000）

#### 文字表示の詳細

**上面図での文字表示（鏡文字）**
- **理由**: 金型の底面から見た時の文字の形を表現するため。金型に液体を流し込むと、底面に彫られた文字が製品に転写されます。そのため、金型の底面には鏡文字で彫る必要があります。
- **表示方法**: 
  1. ハッチング（文字の内部に斜線を描画）
  2. 輪郭線（文字の輪郭を太線で描画）
  3. 左右反転（通常の文字を左右反転）

**意匠面図での文字表示（通常文字）**
- **理由**: 実際に彫り込まれる文字の見た目を確認するため。意匠面図は、文字が彫り込まれる面を正面から見た図なので、通常の文字で表示します。
- **表示方法**: 
  1. 輪郭線のみ（ハッチングなし）
  2. 左右反転なし（通常の文字）

#### 寸法の読み方（初心者向け）

**寸法線とは**: 物体の長さを示す線です。矢印と数値で「ここからここまで何mm」と示します。

**寸法の見方**: `←─── 76.91 ───→` は「左端から右端まで76.91mm」という意味です。

**寸法の単位**: すべてmm（ミリメートル）で表示されます。
- 1mm = 0.1cm
- 10mm = 1cm
- 100mm = 10cm

**よく出てくる寸法**:
- **外形寸法**: 76.91mm × 113.91mm（外側）、70.00mm × 107.00mm（内側）
- **キャビティ寸法**: 57.90mm × 97.30mm
- **深さ寸法**: 24.60mm（総高さ）、24.50mm（容器内深さ）、3.00mm（文字彫り込み深さ）
- **コーナー半径**: R9.46mm（外側）、R6.00mm（内側）

#### 図面の見方のコツ
1. **まず上面図を見る**: 上面図が最も情報量が多いので、まずここを見ましょう。
2. **断面図で深さを確認**: 上面図では深さが分からないので、断面図で深さを確認しましょう。
3. **寸法線を追う**: 寸法線を追うことで、各パーツのサイズと位置関係が分かります。
4. **中心線を意識する**: 中心線は図面の中心を示すので、パーツの位置関係を理解するのに役立ちます。
5. **ハッチングで断面を識別**: ハッチング（斜線）がある部分は「ここが断面です」という意味です。

### 3.4 3Dモデル表示機能

#### 表示内容
- **アイス本体**: 文字の形をした3Dモデル（ピンク色）
- **スティック**: 文字の下に配置される棒（ダークグレー）
- **背景**: グレーのグラデーション背景
- **グリッド**: 地面にグリッド線を表示

#### 操作機能
- **回転**: マウスドラッグで回転
- **ズーム**: マウスホイールで拡大・縮小
- **パン**: マウスドラッグで移動

#### ライティング
- 環境光（暗め）
- 指向性ライト（2つ）
- 影（ContactShadows）

### 3.5 出力機能

#### 3Dモデル出力（特許申請用 - 最優先）
- **形式**: HTML/PDFなど、ブラウザで見れる形式
- **要件**: くるくる回せる（インタラクティブに回転できる）
- **用途**: 特許事務所への提出用
- **厳密性**: そこまで厳密でなくていい（デザインが申請されていることが確認できればOK）
- **表示内容**:
  - **表面（表）**: 漢字が見える（例：「鎌倉」）
  - **裏面（裏）**: 塗りつぶした板みたい（「鎌倉を塗りつぶした板みたい」）
  - **棒（スティック）**: ついている
- **優先度**: **最優先（急ぎ）**

#### PNG画像出力（2D図面 - 金型業者用）
- **形式**: PNG
- **ファイル名**: `{入力文字}_図面.png`（例：「鎌倉_図面.png」）
- **解像度**: キャンバスサイズそのまま（1400×900ピクセル）
- **用途**: 金型業者への提出用
- **厳密性**: できるだけ精密に
- **優先度**: 次（3Dモデルができた後に取り組む）

#### 3Dモデル出力（STL形式 - 将来対応）
- 現在は未対応
- 3Dプリンター用のSTL形式での出力を予定

### 3.6 表示モード切り替え
- **2D図面モード**: 技術図面を表示
- **3Dモデルモード**: 3Dプレビューを表示
- ボタンで切り替え可能

---

## 4. 技術仕様

### 4.1 フォント処理

#### 使用フォント
- **ファイル**: `NotoSansJP-Bold.otf`
- **サイズ**: 16.2MB
- **形式**: OpenType Font（OTF）
- **場所**: `public/fonts/` ディレクトリ

#### フォント処理の流れ
1. フォントファイルを読み込み（opentype.js使用）
2. 各文字をパス（輪郭線）に変換
3. ベジェ曲線を直線に近似（曲線あたり5セグメント）
4. 文字内の穴（漢字の「口」部分など）を検出
   - 時計回り/反時計回りの判定（Shoelace公式）
   - 点が多角形内にあるかの判定（レイキャスティング）
5. 文字埋め処理がONの場合：
   - clipper2-jsを使用して文字パスを膨張
   - 複数文字を統合
   - 小さな穴を除去

#### 文字レイアウト
- **方向**: 縦書き（上から下へ）
- **文字間隔**: フォントサイズの1.02倍
- **最大サイズ**: 縦105mm × 横62mm（クライアント提供情報）
  - ただし、キャビティサイズ（57.90mm × 97.30mm）より大きいため、実際にはキャビティ内に収まるサイズに調整される

### 4.2 図面描画

#### スケール
- **mm → ピクセル変換**: 3.2倍
  - 例：76.91mm → 約246ピクセル

#### 線の種類
- **外形線**: 太線（1.2px）
- **内側線**: 細線（0.8px）
- **中心線**: 細線（0.4px）、一点鎖線
- **寸法線**: 細線（0.4px）
- **ハッチング**: 細線（0.3px）

#### 色
- **背景**: 白（#ffffff）
- **線・文字**: 黒（#000000）

### 4.3 3Dモデル生成（特許申請用 - 最優先）

#### アイス本体の構造（重要 - クライアント提供情報に基づく）

**構造**:
- **土台（板）**: 四角い長方形の板を下に配置
  - **厚み**: 19mm（クライアント提供情報）
- **文字**: その上に文字を浮かせる
  - **土台から文字の厚み**: 3mm（クライアント提供情報）
  - **最大サイズ**: 縦105mm × 横62mm（クライアント提供情報）
  - **形状**: 文字の形をZ方向に押し出し（ExtrudeGeometry）
  - **テーパー角度**: 8°（できれば実装、推奨）（クライアント提供情報）
- **アイスの総厚み**: 22mm（土台19mm + 文字3mm）（クライアント提供情報）
- **アウトライン**: 漢字に沿わせる（クライアント確認済み）
- **ベベル**: 有効（角を丸める）
- **色**: ピンク（#FFB6C1）

#### 表面と裏面
- **表面（表）**: 漢字が見える（例：「鎌倉」）
- **裏面（裏）**: 塗りつぶした板みたい（「鎌倉を塗りつぶした板みたい」）

#### スティック
- **寸法**: 10mm × 2mm × 60mm（要確認：具体的な数値は未提供）
- **角の丸み**: 0.5mm
- **位置**: 中央（クライアント提供情報）
- **色**: ダークグレー（#2F2F2F）

#### 微調整
- **隙間の処理**: 実際のアイスは多分隙間にもまだアイスが入ったりする
- **文字の浮き**: 最終的なアイスにもうちょっと「カ」と「ク」が浮いている
- そのような微調整ができれば完璧

---

## 5. UI/UX要件

### 5.1 レイアウト

#### 左パネル（コントロールパネル）
- **幅**: 384ピクセル（固定）
- **背景色**: ダークグレー（#1F2937）
- **スクロール**: 縦方向にスクロール可能

#### 右パネル（表示エリア）
- **幅**: 残りの全幅（可変）
- **背景色**: ライトグレー（#F3F4F6）

### 5.2 コントロール要素

#### 2D/3D切り替えボタン
- **配置**: 左パネル上部
- **スタイル**: タブ形式
- **アクティブ**: シアン（#06B6D4）
- **非アクティブ**: グレー

#### 固定パラメータ表示
- **形式**: グリッド（2列）
- **表示内容**: 上部サイズ、底部サイズ、深さ、彫り深さ、勾配
- **スタイル**: 小さなカード形式

#### 可変パラメータ
- **形式**: スライダー（range input）
- **表示**: ラベル、現在値、スライダー
- **単位**: mm、%、°を明示

#### 出力ボタン
- **配置**: 左パネル下部
- **色**: 緑（#16A34A）
- **状態**: 2Dモード時のみ有効

### 5.3 フィードバック

#### リアルタイム更新
- パラメータ変更時に即座に図面/3Dモデルを更新
- 遅延なし

#### エラー表示
- フォント読み込み失敗時：赤いメッセージを表示
- フォント読み込み中：ローディングメッセージを表示

---

## 6. 制約事項・注意事項

### 6.1 技術的制約

#### フォント
- **必須ファイル**: `public/fonts/NotoSansJP-Bold.otf` が存在すること
- **サポート形式**: TTF, OTF, WOFF（WOFF2は非対応）
- **サイズ**: 16.2MB（読み込みに時間がかかる可能性）

#### ブラウザ
- **Canvas API**: 2D図面描画に使用
- **WebGL**: 3Dモデル表示に使用（Three.js）
- モダンブラウザ必須

#### パフォーマンス
- フォント読み込み：初回のみ（キャッシュされる）
- 図面再描画：パラメータ変更のたびに全描画
- 3Dモデル再生成：パラメータ変更のたびに再計算

### 6.2 機能制約

#### 文字入力
- 最大4文字まで
- 日本語のみ（英数字未対応）

#### 出力
- 2D図面：PNG形式のみ
- 3Dモデル：未対応（将来対応予定）

#### パラメータ範囲
- すべてのパラメータに範囲制限あり
- 固定パラメータは変更不可

### 6.3 図面の制約

#### 図面の精度
- 寸法値は固定パラメータに基づく
- ユーザーが寸法を直接編集することはできない
- 図面は参考図面（`cad-sample/`フォルダ内）に基づいて作成

#### 図面の標準
- JIS規格に準拠した図面記号を使用
- ただし、完全なJIS準拠ではない（簡易版）

---

## 7. 将来拡張予定機能

### 7.1 3Dモデル出力
- STL形式でのエクスポート
- OBJ形式でのエクスポート

### 7.2 図面出力の拡張
- PDF形式での出力
- SVG形式での出力
- 高解像度PNG出力

### 7.3 パラメータの拡張
- フォントの選択
- 文字色の変更
- 複数テキストの配置

### 7.4 その他
- テンプレート保存・読み込み
- 図面の印刷機能
- 寸法のカスタマイズ

---

## 8. 用語集（図面知識がない方向け）

### 8.1 金型関連

**金型（かながた）**
- アイスキャンディーを成形するための型
- 液体を流し込んで冷やすと、型の形に固まる

**キャビティ**
- 金型の中の、製品（アイス）が入る部分
- ここに文字が彫り込まれる

**フランジ**
- 金型の縁（ふち）の部分
- 型を固定するために使う

**テーパー（勾配）**
- 側面が斜めになっていること
- 型から製品を抜きやすくするため

### 8.2 図面関連

**断面図**
- 物体を切った時の断面を見た図
- ハッチング（斜線）で断面部分を表現

**上面図**
- 上から見た図
- 平面図ともいう

**正面図**
- 正面から見た図
- 立面図ともいう

**寸法線**
- 長さを示す線
- 矢印と数値で寸法を表示

**中心線**
- 図面の中心を示す線
- 一点鎖線（長い線・短い線の繰り返し）で描く

**ハッチング**
- 断面部分に描く斜線
- 断面であることを示す

**タイトルブロック**
- 図面の右下に配置される情報欄
- 製品名、図面番号などを記載

### 8.3 3D関連

**押し出し（Extrude）**
- 2Dの形をZ方向（奥行き方向）に伸ばして3Dにする
- 例：円を押し出すと円柱になる

**ベベル**
- 角を丸める処理
- より自然な見た目にする

**マテリアル**
- 3Dモデルの質感（色、光沢など）
- 金属、プラスチック、ガラスなど

---

## 9. 参考資料

### 9.1 サンプル図面
プロジェクト内の `cad-sample/` フォルダに参考図面が含まれています：
- `11.27　鎌倉アイス (テーパー8°  21.5h) (2).pdf` - 2D図面
- `11.27　鎌倉アイス (テーパー8°  21.5h)_3D (2).pdf` - 3D図面
- `cad図面正確.jpg` - 図面画像
- `アイスイメージ.jpg` - 完成イメージ

### 9.2 技術ドキュメント
- `CLAUDE.md` - 開発者向け技術ドキュメント
- `README.md` - プロジェクト概要
- `DEPLOYMENT.md` - デプロイメント手順

---

## 10. 要件の優先度（打ち合わせで決定）

### 10.1 最優先機能（P0 - 急ぎ）
- **3Dモデルの生成・出力**（特許申請用）
  - くるくる回せる形式（HTML/PDFなど）
  - 表面：漢字が見える
  - 裏面：塗りつぶした板みたい
  - 棒（スティック）がついている
- **文字埋め処理の改善**
  - 土台（板）を作って、その上に文字を浮かせるアプローチ
  - 周りを削る
  - アウトラインを漢字に合わせる

### 10.2 必須機能（P1）
- 日本語テキスト入力
- 可変パラメータ調整
- リアルタイム更新
- フォント読み込みエラーハンドリング

### 10.3 重要機能（P2 - 3Dモデルができた後に取り組む）
- **2D図面生成**（6つの視点、金型業者用）
  - できるだけ精密に
  - 2D図面を完璧に仕上げて、その情報を元に3Dモデルを起こす
- PNG出力（2D図面）

### 10.4 拡張機能（P3）
- 3Dモデル出力（STL形式、3Dプリンター用）
- PDF出力（2D図面）
- テンプレート保存

---

## 11. 非機能要件

### 11.1 パフォーマンス
- 図面再描画：1秒以内
- 3Dモデル再生成：2秒以内
- フォント読み込み：初回のみ（キャッシュ）

### 11.2 互換性
- モダンブラウザ（Chrome, Firefox, Safari, Edge）
- Node.js 18以上

### 11.3 使いやすさ
- 直感的なUI
- リアルタイムプレビュー
- エラーメッセージの明確化

---

## 12. 確認事項・質問事項

### 12.1 打ち合わせで決定した事項（2025年12月15日）

#### 優先順位
- ✅ **最優先：3Dモデル**（特許申請用、急ぎ）
- ✅ **次：2D図面**（金型業者用、精密に）

#### 3Dモデルの要件
- ✅ くるくる回せる形式（HTML/PDFなど）
- ✅ 表面：漢字が見える
- ✅ 裏面：塗りつぶした板みたい
- ✅ 棒（スティック）がついている
- ✅ そこまで厳密でなくていい（デザインが申請されていることが確認できればOK）

#### 文字埋めのルール（クライアント提供情報により更新）
- ✅ 土台（板）を作って、その上に文字を浮かせるアプローチ
- ✅ 文字の高さは3mmで統一（土台から文字の厚み）
- ✅ 土台の厚みは19mm
- ✅ アイスの総厚みは22mm（土台19mm + 文字3mm）
- ✅ 文字のテーパー角度は8°（できれば実装、推奨）
- ✅ 文字の最大サイズは縦105mm × 横62mm
- ✅ アウトラインは漢字に沿わせる
- ✅ 文字の内側は埋まっている（修正）
- ✅ 棒の位置は中央

### 12.2 確認が必要な事項（クライアントから情報提供待ち）

**追跡方法**: 確認事項はGitHubのIssueで個別に追跡することを推奨します。各確認事項について、必要に応じてIssueを作成して進捗を管理してください。

#### 数値情報（一部確認済み）
- [x] ~~文字の段差の高さ~~ → **3mmで確定**（クライアント提供情報）
- [x] ~~文字の輪郭のルール~~ → **アウトラインは漢字に沿わせる**（クライアント提供情報）
- [x] ~~アイスの厚み~~ → **22mm（土台19mm + 文字3mm）**（クライアント提供情報）
- [x] ~~土台の厚み~~ → **19mm**（クライアント提供情報）
- [x] ~~文字のテーパー角度~~ → **8°（できれば実装）**（クライアント提供情報）
- [x] ~~文字の最大サイズ~~ → **縦105mm × 横62mm**（クライアント提供情報）
- [x] ~~文字の内側の埋め方~~ → **埋まっている**（クライアント提供情報により修正）
- [x] ~~棒の位置~~ → **中央**（クライアント提供情報）
- [ ] 棒の厚み、縦横、長さ（具体的な数値）
- [ ] 棒が大体どの辺ぐらいまで来ているか

#### 図面情報
- [ ] 今作られている図面をいくつか（変わるとこ、変わらないとこ）
- [ ] 実物図面（金型屋さんからもらっている）

#### 写真・実物
- [ ] アイスの試作品の写真（いろんな角度から）
- [ ] 表面、裏面、側面などの写真
- [ ] 現物1個（可能であれば）

### 12.3 製品仕様（要確認）
- [ ] 固定パラメータ（寸法、角度など）は本当に変更不可か？
- [ ] 文字数の上限（2文字、3文字が基本、4文字はないかも）
- [ ] キャビティサイズは固定で良いか？
- [ ] 文字の余白のルール（「外からこの中に入っていて」「余白これだけ」など）

### 12.4 機能要件（要確認）
- [ ] 3Dモデルの出力形式（HTML/PDF以外の形式は必要か？）
- [ ] 2D図面の出力形式（PNG以外）は必要か？
- [ ] 2D図面と3Dモデルの整合性（2D図面を完璧に仕上げて、その情報を元に3Dモデルを起こす）

### 12.5 UI/UX（要確認）
- [ ] 左パネルの幅（384px）は適切か？
- [ ] スライダーの刻み幅は適切か？
- [ ] エラーメッセージの表示方法は適切か？

### 12.6 技術仕様（要確認）
- [ ] フォントファイルのサイズ（16.2MB）は許容範囲か？
- [ ] 図面のスケール（3.2倍）は適切か？
- [ ] ベジェ曲線の近似精度（5セグメント）は十分か？

---

## 13. 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|-----------|---------|--------|
| 2025-12-15 | 2.1 | クライアント提供情報を反映：文字サイズ、厚み、テーパー角度、文字の内側の埋め方などを更新。改善提案に対応：README.mdにREQUIREMENTS.mdへの参照を追加、.gitignoreのフォーマット修正、確認事項の追跡方法を追記、変更履歴に変更者を記録 | Handydigital-dev |
| 2025-12-15 | 2.0 | ドキュメント統合：打ち合わせメモ、2D図面詳細仕様、チェックリストを統合して一つの要件定義書に整理 | Handydigital-dev |
| 2025-12-15 | 1.1 | 打ち合わせ内容を反映：優先順位の明確化、3Dモデルの詳細要件、文字埋めのルール追加 | Handydigital-dev |
| 2025-01-XX | 1.0 | 初版作成 | - |

---

## 14. 打ち合わせで決定した重要なポイント（2025年12月15日）

### 14.1 優先順位（最重要）
1. **最優先：3Dモデル**（特許申請用、急ぎ）
   - くるくる回せる形式（HTML/PDFなど）
   - 表面：漢字が見える、裏面：塗りつぶした板みたい
   - 棒（スティック）がついている
   - そこまで厳密でなくていい

2. **次：2D図面**（金型業者用、精密に）
   - 2D図面を完璧に仕上げて、その情報を元に3Dモデルを起こす

### 14.2 文字埋めのルール（決定 - クライアント提供情報により更新）
- **アプローチ**: 土台（板）を作って、その上に文字を浮かせる
- **固定パラメータ**（クライアント提供情報）:
  - 文字の最大サイズ：縦105mm × 横62mm
  - 土台から文字の厚み：3mm（文字の高さ）
  - 土台の厚み：19mm
  - アイスの総厚み：22mm（土台19mm + 文字3mm）
  - 文字のテーパー角度：8°（できれば実装、推奨）
  - 棒の位置：中央
- **ルール**（クライアント提供情報により更新）:
  - アイスクリームの外枠は基本的に漢字に沿っている
  - アウトラインは漢字に沿わせる
  - 文字と文字の間は段が下がって埋まっている
  - **文字の内側は埋まっている**（クライアント提供情報により修正）
  - 裏面から見た時は塗りつぶした板みたい

### 14.3 3Dモデルの要件
- **出力形式**: HTML/PDFなど、ブラウザで見れる形式
- **表示内容**:
  - 表面（表）：漢字が見える
  - 裏面（裏）：塗りつぶした板みたい
  - 棒（スティック）：ついている
- **厳密性**: そこまで厳密でなくていい（デザインが申請されていることが確認できればOK）

### 14.4 2D図面の要件
- **目的**: 金型業者に出す用
- **厳密性**: できるだけ精密に
- **調整**: 細かい調整は金型業者に任せる

### 14.5 次のアクション

#### クライアント側（一部完了）
- [x] ~~数値情報の提供~~ → **完了**（文字サイズ、厚み、テーパー角度など）
- [ ] 図面の提供（変わるとこ、変わらないとこ）
- [ ] 写真の提供（いろんな角度から）
- [ ] 棒の詳細寸法（厚み、縦横、長さ）

#### 開発側
- [ ] 3Dモデルを優先で作成
  - 土台19mm + 文字3mm = 総厚み22mm
  - 文字のテーパー角度8°を実装（できれば）
  - 文字の内側を埋める処理を実装
  - アウトラインを漢字に沿わせる
- [ ] 文字埋め処理を改善（土台を作って上に文字を乗せるアプローチ）
- [ ] 文字の最大サイズ（縦105mm × 横62mm）を考慮したサイズ計算

---

**注意**: このドキュメントは現在のコードベース（モックアップ）と打ち合わせ内容（2025年12月15日）を分析して作成されました。実際の要件定義では、ステークホルダーとの確認・調整が必要です。


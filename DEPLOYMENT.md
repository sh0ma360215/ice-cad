# Ice CAD デプロイ計画

## プロジェクト特性

- **タイプ**: 静的サイト（React + Vite）
- **バックエンド**: なし（完全フロントエンド）
- **主要アセット**: 日本語フォント（17MB）
- **ビルド出力**: 静的HTML/CSS/JS + アセット

## デプロイオプション比較

### 🥇 推奨: Cloudflare Pages

**メリット:**
- ✅ **完全無料** - 無制限の帯域幅（最重要）
- ✅ **高速CDN** - 世界中に配信拠点
- ✅ **簡単デプロイ** - GitHubと連携、自動ビルド
- ✅ **無制限リクエスト** - 17MBのフォントファイルでも問題なし
- ✅ **高速ビルド** - 月500回まで無料

**無料枠:**
- ビルド: 500回/月
- 帯域幅: **無制限**
- リクエスト: **無制限**
- カスタムドメイン: 対応

**デプロイ手順:**
1. Cloudflareアカウント作成
2. GitHubリポジトリと連携
3. ビルド設定（自動検出）
4. デプロイ完了

---

### 🥈 次点: Vercel

**メリット:**
- ✅ **Viteネイティブサポート** - 設定不要
- ✅ **自動HTTPS** - SSL証明書自動
- ✅ **プレビューデプロイ** - PRごとにプレビュー環境
- ✅ **高速CDN**

**無料枠:**
- ビルド: 6000分/月
- 帯域幅: **100GB/月** ⚠️
- カスタムドメイン: 対応

**注意点:**
- 17MBフォント × アクセス数で帯域制限に注意
- 月間アクセスが多い場合はCloudflareの方が安全

**デプロイ手順:**
1. Vercelアカウント作成
2. GitHubリポジトリと連携
3. 自動検出でデプロイ完了

---

### 🥉 代替: Netlify

**メリット:**
- ✅ **簡単デプロイ**
- ✅ **フォーム機能**（将来的に使える）
- ✅ **CDN**

**無料枠:**
- ビルド: 300分/月
- 帯域幅: **100GB/月** ⚠️

**注意点:**
- Vercelと同じく帯域制限あり

---

### 💰 その他オプション

#### GitHub Pages
- **コスト**: 完全無料
- **デメリット**:
  - 手動設定が必要
  - カスタムドメインが面倒
  - CDNなし
- **推奨度**: ❌ 他の方が楽

#### AWS S3 + CloudFront
- **コスト**: 月1-5ドル程度
- **デメリット**:
  - 設定が複雑
  - AWSアカウント必要
- **推奨度**: ❌ オーバースペック

---

## 最終推奨: Cloudflare Pages

### 理由
1. **完全無料で帯域無制限** - 17MBフォントの配信に最適
2. **Vercel並みの簡単さ** - GitHub連携で自動デプロイ
3. **高速グローバルCDN** - パフォーマンス良好
4. **スケーラビリティ** - アクセス増加に対応

### セットアップ手順

#### 1. ビルド設定確認

現在のビルドコマンド:
```bash
npm run build  # tsc -b && vite build
```

出力ディレクトリ:
```
dist/
```

#### 2. Cloudflare Pages設定

**ビルド設定:**
- Framework preset: `Vite`
- Build command: `npm run build`
- Build output directory: `dist`
- Node version: `18` (package.jsonで指定推奨)

#### 3. 環境変数（必要な場合）

現時点では不要（完全静的サイト）

#### 4. カスタムドメイン（オプション）

Cloudflareでドメイン管理すると連携が簡単:
- example.com → 本番環境
- *.pages.dev → 自動提供されるURL

---

## デプロイフロー

### 本番デプロイ
```
main ブランチへのpush/merge
  ↓
Cloudflare Pages自動ビルド
  ↓
本番環境デプロイ
  ↓
https://ice-cad.pages.dev
```

### プレビューデプロイ
```
feature ブランチへのpush
  ↓
Cloudflare Pages自動ビルド
  ↓
プレビュー環境デプロイ
  ↓
https://[commit-hash].ice-cad.pages.dev
```

---

## パフォーマンス最適化

### フォントファイル最適化（将来的）

17MBのフォントは大きいため、将来的に最適化を検討:

1. **サブセット化**
   - 必要な文字だけ抽出
   - pyftsubset（fonttools）使用
   - 推定削減: 17MB → 1-2MB

2. **WOFF2変換**
   - 現在: OTF（17MB）
   - 変換後: WOFF2（推定5-7MB）
   - ⚠️ opentype.jsはWOFF2非対応のため要確認

3. **CDN最適化**
   - Cloudflareの自動圧縮（Brotli/Gzip）有効
   - キャッシュヘッダー最適化

---

## コスト試算

### Cloudflare Pages（推奨）
- **月額**: $0
- **帯域**: 無制限
- **ビルド**: 500回/月まで無料（超過後$0.50/500回）

### 想定シナリオ
- 月間訪問者: 1000人
- 1人あたり転送量: 20MB（フォント含む）
- 月間転送量: 20GB
- **コスト: $0** ✅

### スケール時
- 月間訪問者: 10,000人
- 月間転送量: 200GB
- Cloudflare: **$0** ✅
- Vercel: 超過（100GB制限）→ 有料プラン$20/月 ❌

---

## 次のステップ

1. ✅ デプロイ計画策定（このドキュメント）
2. ⬜ Cloudflareアカウント作成
3. ⬜ GitHubリポジトリ連携
4. ⬜ 初回デプロイテスト
5. ⬜ カスタムドメイン設定（オプション）
6. ⬜ README.mdにデプロイ手順追記

---

## トラブルシューティング

### ビルドエラー
```bash
# ローカルで本番ビルドテスト
npm run build
npm run preview
```

### フォント読み込みエラー
- publicディレクトリがビルド時に正しくコピーされているか確認
- Network tabでフォントファイルのパスを確認

### 大容量アセット警告
- Viteの警告は無視してOK（フォントファイルは必須）
- 将来的にサブセット化で対応

---

## まとめ

- **推奨プラットフォーム**: Cloudflare Pages
- **月額コスト**: $0（無制限帯域）
- **デプロイ難易度**: ⭐⭐☆☆☆（Vercel並みに簡単）
- **スケーラビリティ**: ⭐⭐⭐⭐⭐（完璧）
